<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Freeshooter</title>
    <meta
      name="viewport"
      content="width=device-width, height=device-height,
    user-scalable=no, initial-scale=1, maximum-scale=1"
    />
    <script src="https://unpkg.com/sounds-some-sounds@3.0.0/build/index.js"></script>
    <script src="https://unpkg.com/gif-capture-canvas@1.1.0/build/index.js"></script>
    <script src="https://unpkg.com/pixi.js@5.3.0/dist/pixi.min.js"></script>
    <script src="https://unpkg.com/pixi-filters@3.1.1/dist/pixi-filters.js"></script>
    <script src="https://unpkg.com/crisp-game-lib@1.1.1/docs/bundle.js"></script>

    <script>
      title = "Freeshooting";

      description = `
      `;

      characters = [
        `
 ll
llll
 yy
 yylll
 LLl
 LL
      `,
        `
  gg  
  gg g
g gg g
gggggg
  gg  
  gg  
      `,
      ];

      const G = {
        WIDTH: 150,
        HEIGHT: 50,
      };

      options = {
        viewSize: { x: G.WIDTH, y: G.HEIGHT },
      };

      const AMMO_MAX = 5;
      const shotBullets = [];
      let curAmmo;

      const allEnemies = [];

      function update() {
        if (!ticks) {
          curAmmo = AMMO_MAX;
        }

        if (input.isJustPressed) {
          fireBullet();
        }
        drawBullets();
        moveBullets();

        if (allEnemies.length == 0) {
          addEnemies();
        }
        //drawEnemies();
        moveEnemies();
        handleCollisions();
      }

      function fireBullet() {
        if (curAmmo > 0) {
          shotBullets.push(0);
          curAmmo -= 1;
        }
      }

      function drawBullets() {
        shotBullets.forEach((bulletPos) => {
          color("yellow");
          rect(bulletPos + 6, (G.HEIGHT * 2) / 3, 1, 1);
        });

        color("black");
        char("a", 6, (G.HEIGHT * 2) / 3);
      }

      function moveBullets() {
        for (i = 0; i < shotBullets.length; i++) {
          shotBullets[i] += 1;
        }
      }

      function addEnemies() {
        allEnemies.push(G.WIDTH + 4);
      }

      function drawEnemies() {
        allEnemies.forEach((enemyPos) => {
          color("black");
          char("b", enemyPos, (G.HEIGHT * 2) / 3);
        });
      }

      function moveEnemies() {
        for (i = 0; i < allEnemies.length; i++) {
          allEnemies[i] -= 1;
        }
      }

      function handleCollisions() {
        remove(allEnemies, (e) => {
          const bulletEnemyCollision = char("b", e, (G.HEIGHT * 2) / 3)
            .isColliding.rect.yellow;
          return e < 0 || bulletEnemyCollision;
        });

        remove(shotBullets, (b) => {
          color("yellow");
          const isCollidingWithEnemies = box(b + 6, (G.HEIGHT * 2) / 3, 1)
            .isColliding.char.b;
          return isCollidingWithEnemies || b > G.WIDTH;
        });
      }

      addEventListener("load", onLoad);
    </script>
  </head>
  <body style="background: #ddd"></body>
</html>
